<?xml version="1.0"?>
<!DOCTYPE project [
    <!ENTITY include SYSTEM "file:..\..\buildtools\build.include">
]>
<project default="compile">
    &include;
    <target name="dep_versions" description="specifies versions of dependents">
        #foreach ($dep in $deps)
            <property name="${dep.name}.v" value="${dep.version}" />
        #end
        #foreach ($dep in $deps)
            <property name="${dep.name}.dir" value="../../${dep.name}/${dep.name}-${${dep.name}.v}" />
        #end
    </target>

    <target name="clean" depends="dep_versions,props" description="deletes project tree (+dependents)">
        #foreach ($dep in $deps)
            <antcall target="clean_proj">
                <param name="build.clean" location="${${dep.name}.dir}" />
            </antcall>
        #end
        <antcall target="clean_keep_build" />
    </target>

    <target name="fetch" depends="dep_versions,props" description="fetches project tree (+dependents)">
        #foreach ($dep in $deps)
            <antcall target="fetch_proj">
                <param name="build.fetch.project" value="${dep.name}" />
                <param name="build.fetch.version" value="${${dep.name}.v}" />
            </antcall>
        #end
        <antcall target="fetch_proj" />
    </target>

    <target name="compile" depends="cp,dep_versions,props" description="compiles java files (+dependents)">
        #foreach ($dep in $deps)
            #if ($dep.source)
                <ant target="compile_proj" dir="${${dep.name}.dir}" inheritAll="false">
                    <reference refid="eclipse.classpath" />
                </ant>
            #end
        #end
        <antcall target="compile_proj">
            <reference refid="eclipse.classpath" />
        </antcall>
    </target>

    <target name="jar" depends="dep_versions,props" description="creates jar file (+dependents)">
        #foreach ($dep in $deps)
            #if ($dep.source)
                <ant target="jar_proj" dir="${${dep.name}.dir}" inheritAll="false" />
            #end
        #end
        #if ($main == "")
            <antcall target="jar_proj" />
        #else
            <antcall target="jar_proj">
                <param name="build.jar.main" value="$main" />
            </antcall>
        #end
    </target>
    #set ($dollar = "$")
    <target name="deploy" depends="dep_versions,props" description="Gets dependents, creates archive, and deploys to target machine">
        #foreach ($dep in $deps)
            <ant target="copy_to_parent" dir="${${dep.name}.dir}" inheritAll="false">
                <property name="build.copy.dir" location="${dollar}{lib}" />
            </ant>
        #end
        <antcall target="deploy_proj" />
    </target>

    <target name="copy_to_parent" depends="props" description="Copies this project's output files to parent project">
        <fileset id="build.copy.fileset" dir="${dollar}{lib}" includes="**/*" />
        <antcall target="copy_fileset" inheritRefs="true" />
    </target>
</project>
