:BUILD
SETLOCAL

IF NOT DEFINED ROOTDIR GOTO :EOF

SET SRCDIR=%~dp0
SET SRCDIR=%SRCDIR:~0,-1%
SET INCDIR=%ROOTDIR%\lib\macros


SET VERS=%1

CALL :ASM intbasic %VERS%
IF ERRORLEVEL 1 GOTO :EOF

%CC65DIR%\ld65 -v -C %SRCDIR%\intbasic.cfg -m intbasic.map intbasic.o65
IF ERRORLEVEL 1 GOTO :EOF



ENDLOCAL
GOTO :EOF







:ASM
SETLOCAL

COPY /Y %SRCDIR%\%~1.s65 .

%CC65DIR%\ca65 -v -l -t apple2 -I %SRCDIR% -I %INCDIR% -o %~1.o65 -D VERSION=%~2 %~1.s65
SET /A ERR=%ERRORLEVEL%

DEL /F /Q %~1.s65

IF %ERR% NEQ 0 EXIT /B %ERR%

ENDLOCAL
GOTO :EOF
